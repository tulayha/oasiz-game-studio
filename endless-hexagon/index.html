<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="/style.css">
    <title>Endless Hexagon</title>
    <style>
        @font-face {
            font-family: 'Press Start 2P';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url(/fonts/PressStart2P.ttf) format('truetype');
        }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            width: 100%; height: 100%; overflow: hidden; touch-action: none;
            font-family: 'Press Start 2P', monospace, cursive;
            -webkit-tap-highlight-color: transparent;
        }
        .hidden { display: none !important; }
        #app { position: relative; width: 100%; height: 100%; background-color: #0f172a; }
        #game-container { width: 100%; height: 100%; }

        /* ===== MAIN MENU ===== */
        #main-menu {
            position: absolute; top: 0; right: 0; bottom: 0; left: 0; z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 700ms ease, visibility 700ms ease;
        }
        #main-menu.menu-hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .menu-title-wrap { margin-bottom: 6rem; margin-top: -6rem; text-align: center; animation: float 4s ease-in-out infinite; }
        .menu-title { font-family: 'Press Start 2P', monospace, cursive; font-size: 3rem; line-height: 1.2; color: #facc15; letter-spacing: 0.1em; filter: drop-shadow(4px 4px 0 #000); margin-bottom: 1rem; }
        @media (min-width: 768px) { .menu-title { font-size: 4.5rem; } }
        .menu-subtitle { font-family: 'Press Start 2P', monospace, cursive; font-size: 0.65rem; color: #94a3b8; letter-spacing: 0.4em; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @media (min-width: 768px) { .menu-subtitle { font-size: 0.8rem; } }

        /* ===== PLAY BUTTON ===== */
        #play-btn {
            position: relative; padding: 1.25rem 3.5rem;
            background-color: #facc15; color: #0f172a;
            font-family: 'Press Start 2P', monospace, cursive; font-size: 1.25rem;
            border: 4px solid #000; cursor: pointer;
            transition: all 100ms ease;
            box-shadow: 0 6px 0 0 #a16207;
        }
        #play-btn:not(.loading):hover { background-color: #fde047; transform: translateY(-2px); box-shadow: 0 8px 0 0 #a16207; }
        #play-btn:not(.loading):active { transform: translateY(4px); box-shadow: none; }
        #play-btn.loading { opacity: 0.5; cursor: wait; }

        /* ===== SETTINGS GEAR ===== */
        #settings-btn {
            position: absolute; top: 45px; right: 1.25rem; z-index: 50;
            width: 3rem; height: 3rem;
            background-color: rgba(15, 23, 42, 0.7); color: #facc15;
            display: flex; align-items: center; justify-content: center;
            border: 3px solid #facc15; cursor: pointer;
            transition: background-color 150ms ease;
        }
        #settings-btn:hover { background-color: rgba(250, 204, 21, 0.15); }
        @media (pointer: coarse) { #settings-btn { top: 120px; } }
        #settings-btn svg { width: 22px; height: 22px; fill: currentColor; }

        /* ===== MODAL OVERLAY ===== */
        .modal-overlay {
            position: absolute; top: 0; right: 0; bottom: 0; left: 0;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex; align-items: center; justify-content: center;
        }
        #game-over-modal { z-index: 40; }
        #settings-modal { z-index: 50; }

        /* ===== MODAL CARD (Dark Retro) ===== */
        .modal-card {
            width: 90%; max-width: 24rem;
            background-color: rgba(15, 23, 42, 0.97);
            padding: 2rem 1.5rem;
            border: 4px solid #facc15;
            position: relative;
        }

        /* ===== GAME OVER MODAL ===== */
        .go-header { margin-bottom: 1.5rem; text-align: center; }
        .go-header h1 {
            font-family: 'Press Start 2P', monospace, cursive;
            font-size: 1.5rem; color: #ef4444;
            filter: drop-shadow(3px 3px 0 #000);
            margin-bottom: 0.75rem;
        }
        @media (min-width: 768px) { .go-header h1 { font-size: 2rem; } }
        .go-divider { height: 3px; width: 100%; background: linear-gradient(90deg, transparent, #facc15, transparent); }
        .go-scores { text-align: center; margin: 1.5rem 0 2rem; }
        .go-scores .label {
            font-family: 'Press Start 2P', monospace, cursive;
            color: #94a3b8; font-size: 0.6rem; letter-spacing: 0.2em; margin-bottom: 0.75rem;
        }
        #final-score {
            font-family: 'Press Start 2P', monospace, cursive;
            font-size: 2.5rem; line-height: 1; color: #facc15;
            filter: drop-shadow(3px 3px 0 #000);
        }
        @media (min-width: 768px) { #final-score { font-size: 3rem; } }

        /* ===== MODAL BUTTONS ===== */
        .modal-buttons { display: flex; flex-direction: column; gap: 0.75rem; }
        .modal-btn {
            width: 100%; padding: 0.9rem;
            font-family: 'Press Start 2P', monospace, cursive;
            font-size: 0.7rem; letter-spacing: 0.1em;
            border: 3px solid #000; cursor: pointer;
            transition: all 100ms ease;
        }
        #restart-btn {
            background-color: #facc15; color: #0f172a;
            box-shadow: 0 4px 0 0 #a16207;
        }
        #restart-btn:hover { background-color: #fde047; transform: translateY(-2px); box-shadow: 0 6px 0 0 #a16207; }
        #restart-btn:active { transform: translateY(3px); box-shadow: none; }
        #go-settings-btn {
            background-color: #1e293b; color: #94a3b8;
            border-color: #334155;
            box-shadow: 0 4px 0 0 #0f172a;
        }
        #go-settings-btn:hover { background-color: #334155; color: #e2e8f0; transform: translateY(-2px); box-shadow: 0 6px 0 0 #0f172a; }
        #go-settings-btn:active { transform: translateY(3px); box-shadow: none; }

        /* ===== SETTINGS MODAL ===== */
        .settings-header { margin-bottom: 1.5rem; text-align: center; }
        .settings-header h2 {
            font-family: 'Press Start 2P', monospace, cursive;
            font-size: 1.1rem; color: #facc15;
            filter: drop-shadow(2px 2px 0 #000);
            margin-bottom: 0.75rem;
        }
        .settings-divider { height: 3px; width: 6rem; background: linear-gradient(90deg, transparent, #facc15, transparent); margin: 0 auto; }

        .settings-list { display: flex; flex-direction: column; gap: 1rem; }
        .settings-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 0.75rem 1rem;
            background-color: rgba(30, 41, 59, 0.8);
            border: 2px solid #334155;
        }
        .settings-row-left { display: flex; align-items: center; gap: 0.75rem; }
        .settings-row-left svg { width: 20px; height: 20px; fill: #facc15; }
        .settings-row-left .setting-label {
            font-family: 'Press Start 2P', monospace, cursive;
            font-size: 0.55rem; color: #e2e8f0;
        }

        /* ===== PIXEL TOGGLE ===== */
        .pixel-toggle {
            width: 56px; height: 28px;
            background-color: #334155; border: 3px solid #475569;
            cursor: pointer; position: relative;
            transition: all 200ms ease;
            display: flex; align-items: center;
        }
        .pixel-toggle.active {
            background-color: #facc15; border-color: #a16207;
        }
        .pixel-toggle .toggle-knob {
            width: 18px; height: 18px;
            background-color: #64748b;
            position: absolute; left: 3px;
            transition: all 200ms ease;
        }
        .pixel-toggle.active .toggle-knob {
            left: calc(100% - 21px);
            background-color: #0f172a;
        }
        .pixel-toggle .toggle-label {
            font-family: 'Press Start 2P', monospace, cursive;
            font-size: 0.35rem; color: #94a3b8;
            position: absolute; width: 100%; text-align: center;
            pointer-events: none; letter-spacing: 0.05em;
        }
        .pixel-toggle.active .toggle-label { color: #0f172a; }

        /* ===== CLOSE BUTTON ===== */
        .settings-close-wrap { margin-top: 1.5rem; }
        #close-settings {
            width: 100%; padding: 0.75rem;
            background-color: #1e293b; color: #94a3b8;
            font-family: 'Press Start 2P', monospace, cursive;
            font-size: 0.6rem; letter-spacing: 0.1em;
            border: 3px solid #334155; cursor: pointer;
            transition: all 100ms ease;
            box-shadow: 0 4px 0 0 #0f172a;
        }
        #close-settings:hover { background-color: #334155; color: #e2e8f0; transform: translateY(-2px); box-shadow: 0 6px 0 0 #0f172a; }
        #close-settings:active { transform: translateY(3px); box-shadow: none; }

        /* ===== ANIMATIONS ===== */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .4; } }
    </style>
</head>
<body>
    <div id="app">
        <div id="game-container"></div>
        <div id="main-menu">
            <div class="menu-title-wrap">
                <h1 class="menu-title">ENDLESS<br>HEXAGON</h1>
                <p class="menu-subtitle">PRESS PLAY TO START</p>
            </div>
            <button id="play-btn">PLAY</button>
        </div>
        <button id="settings-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.49.49 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96a.49.49 0 0 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6A3.6 3.6 0 1 1 12 8.4a3.6 3.6 0 0 1 0 7.2z"/></svg>
        </button>

        <!-- GAME OVER MODAL -->
        <div id="game-over-modal" class="modal-overlay hidden">
            <div class="modal-card">
                <div class="go-header">
                    <h1>GAME OVER</h1>
                    <div class="go-divider"></div>
                </div>
                <div class="go-scores">
                    <p class="label">FINAL SCORE</p>
                    <p id="final-score">0</p>
                </div>
                <div class="modal-buttons">
                    <button id="restart-btn" class="modal-btn">RESTART</button>
                    <button id="go-settings-btn" class="modal-btn">SETTINGS</button>
                </div>
            </div>
        </div>

        <!-- SETTINGS MODAL -->
        <div id="settings-modal" class="modal-overlay hidden">
            <div class="modal-card">
                <div class="settings-header">
                    <h2>SETTINGS</h2>
                    <div class="settings-divider"></div>
                </div>
                <div class="settings-list">
                    <div class="settings-row">
                        <div class="settings-row-left">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>
                            <span class="setting-label">MUSIC</span>
                        </div>
                        <div class="pixel-toggle active" id="music-toggle">
                            <div class="toggle-knob"></div>
                            <span class="toggle-label">ON</span>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-left">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                            <span class="setting-label">SOUND FX</span>
                        </div>
                        <div class="pixel-toggle active" id="fx-toggle">
                            <div class="toggle-knob"></div>
                            <span class="toggle-label">ON</span>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-left">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 15h2V9H0v6zm3 2h2V7H3v10zm19-8v6h2V9h-2zm-3 8h2V7h-2v10zM16.5 3h-9C6.67 3 6 3.67 6 4.5v15c0 .83.67 1.5 1.5 1.5h9c.83 0 1.5-.67 1.5-1.5v-15c0-.83-.67-1.5-1.5-1.5zM16 19H8V5h8v14z"/></svg>
                            <span class="setting-label">HAPTICS</span>
                        </div>
                        <div class="pixel-toggle active" id="haptics-toggle">
                            <div class="toggle-knob"></div>
                            <span class="toggle-label">ON</span>
                        </div>
                    </div>
                </div>
                <div class="settings-close-wrap">
                    <button id="close-settings">CLOSE</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        window.platform = {
            musicEnabled: localStorage.getItem('musicEnabled') !== 'false',
            fxEnabled: localStorage.getItem('fxEnabled') !== 'false',
            hapticsEnabled: localStorage.getItem('hapticsEnabled') !== 'false',
        };

        var settingsBtn = document.getElementById('settings-btn');
        var settingsModal = document.getElementById('settings-modal');
        var closeSettingsBtn = document.getElementById('close-settings');
        var gameOverModal = document.getElementById('game-over-modal');
        var finalScoreEl = document.getElementById('final-score');
        var restartBtn = document.getElementById('restart-btn');
        var goSettingsBtn = document.getElementById('go-settings-btn');
        var mainMenu = document.getElementById('main-menu');
        var playBtn = document.getElementById('play-btn');
        var musicToggle = document.getElementById('music-toggle');
        var fxToggle = document.getElementById('fx-toggle');
        var hapticsToggle = document.getElementById('haptics-toggle');

        // --- Pixel Toggle Helper ---
        function setToggleState(el, active) {
            if (active) {
                el.classList.add('active');
                el.querySelector('.toggle-label').textContent = 'ON';
            } else {
                el.classList.remove('active');
                el.querySelector('.toggle-label').textContent = 'OFF';
            }
        }

        // Init toggle visuals from saved settings
        setToggleState(musicToggle, window.platform.musicEnabled);
        setToggleState(fxToggle, window.platform.fxEnabled);
        setToggleState(hapticsToggle, window.platform.hapticsEnabled);

        // --- Toggle Click Handlers ---
        musicToggle.onclick = function() {
            var enabled = !window.platform.musicEnabled;
            window.platform.musicEnabled = enabled;
            localStorage.setItem('musicEnabled', enabled.toString());
            setToggleState(musicToggle, enabled);
            if (window.toggleMusic) window.toggleMusic(enabled);
            if (window.triggerHaptic) window.triggerHaptic('light');
        };
        fxToggle.onclick = function() {
            var enabled = !window.platform.fxEnabled;
            window.platform.fxEnabled = enabled;
            localStorage.setItem('fxEnabled', enabled.toString());
            setToggleState(fxToggle, enabled);
            if (window.triggerHaptic) window.triggerHaptic('light');
        };
        hapticsToggle.onclick = function() {
            var enabled = !window.platform.hapticsEnabled;
            window.platform.hapticsEnabled = enabled;
            localStorage.setItem('hapticsEnabled', enabled.toString());
            setToggleState(hapticsToggle, enabled);
            if (window.triggerHaptic) window.triggerHaptic('light');
        };

        // --- Settings Open/Close ---
        function openSettings() {
            settingsModal.classList.remove('hidden');
            if (window.triggerHaptic) window.triggerHaptic('light');
            if (window.pauseGame) window.pauseGame();
        }
        function closeSettingsFn() {
            settingsModal.classList.add('hidden');
            if (window.triggerHaptic) window.triggerHaptic('light');
            if (window.resumeGame) window.resumeGame();
        }
        settingsBtn.onclick = openSettings;
        closeSettingsBtn.onclick = closeSettingsFn;
        goSettingsBtn.onclick = openSettings;

        // --- Restart ---
        restartBtn.onclick = function() {
            if (window.triggerHaptic) window.triggerHaptic('medium');
            gameOverModal.classList.add('hidden');
            mainMenu.classList.remove('menu-hidden');
            if (window.restartGame) window.restartGame();
        };

        // --- Play Button ---
        playBtn.disabled = true;
        playBtn.classList.add('loading');
        playBtn.textContent = "LOADING...";

        window.onGameReady = function() {
            playBtn.disabled = false;
            playBtn.classList.remove('loading');
            playBtn.textContent = "PLAY";
        };
        playBtn.onclick = function() {
            if (playBtn.disabled) return;
            if (window.triggerHaptic) window.triggerHaptic('medium');
            if (window.startGame) window.startGame();
            mainMenu.classList.add('menu-hidden');
        };
        window.showMainMenu = function() {
            mainMenu.classList.remove('menu-hidden');
            gameOverModal.classList.add('hidden');
        };

        // --- Game Over ---
        window.showGameOver = function(score) {
            finalScoreEl.textContent = score;
            gameOverModal.classList.remove('hidden');
        };

        // Platform overrides these; fallbacks for local dev only
        if (typeof window.submitScore !== 'function') {
            window.submitScore = function(score) {
                console.log("[Game] Submitting score:", score);
            };
        }
        if (typeof window.triggerHaptic !== 'function') {
            window.triggerHaptic = function(type) {
                if (!window.platform.hapticsEnabled) return;
                if (navigator.vibrate) navigator.vibrate(10);
            };
        }

        // --- Button Click SFX ---
        var clickSound = new Audio('/audio/ButtonClick.wav');
        function playClick() {
            if (window.platform.fxEnabled) {
                clickSound.currentTime = 0;
                clickSound.play().catch(function() {});
            }
        }
        document.querySelectorAll('button').forEach(function(btn) { btn.addEventListener('click', playClick); });
        document.querySelectorAll('.pixel-toggle').forEach(function(t) { t.addEventListener('click', playClick); });
    </script>
    <script type="module" src="/src/main.ts"></script>
</body>
</html>
