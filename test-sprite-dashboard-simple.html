<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sprite Dashboard Tester</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #1a1a2e;
  color: #e0e0e0;
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}
h1 { color: #00A1E4; }
.test-section {
  background: #13132a;
  border: 1px solid #2a2a4a;
  border-radius: 12px;
  padding: 20px;
  margin: 20px 0;
}
.test-section h2 {
  color: #00A1E4;
  margin-top: 0;
}
.status {
  padding: 8px 12px;
  border-radius: 8px;
  display: inline-block;
  margin: 5px 0;
  font-weight: 600;
}
.status.pass { background: #2ecc71; color: #fff; }
.status.fail { background: #e74c3c; color: #fff; }
.status.pending { background: #f39c12; color: #fff; }
button {
  background: #00A1E4;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  margin: 5px;
}
button:hover { background: #0088c7; }
#results { margin-top: 20px; }
.result-item {
  background: #1a1a2e;
  padding: 10px;
  margin: 5px 0;
  border-radius: 6px;
  border-left: 3px solid #00A1E4;
}
.error-item {
  border-left-color: #e74c3c;
}
iframe {
  width: 100%;
  height: 800px;
  border: 2px solid #2a2a4a;
  border-radius: 8px;
  margin: 10px 0;
}
</style>
</head>
<body>
<h1>ðŸ§ª Sprite Dashboard Tester</h1>

<div class="test-section">
  <h2>Test Controls</h2>
  <button onclick="runAllTests()">Run All Tests</button>
  <button onclick="loadDashboard()">Load Dashboard in Frame</button>
  <button onclick="clearResults()">Clear Results</button>
</div>

<div class="test-section">
  <h2>Dashboard Preview</h2>
  <iframe id="dashboard-frame" src=""></iframe>
</div>

<div class="test-section">
  <h2>Test Results</h2>
  <div id="results"></div>
</div>

<script>
let testResults = [];

function log(message, type = 'info') {
  const timestamp = new Date().toLocaleTimeString();
  testResults.push({ timestamp, message, type });
  updateResults();
}

function updateResults() {
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = testResults.map(r => `
    <div class="result-item ${r.type === 'error' ? 'error-item' : ''}">
      <strong>[${r.timestamp}]</strong> ${r.message}
    </div>
  `).join('');
  resultsDiv.scrollTop = resultsDiv.scrollHeight;
}

function clearResults() {
  testResults = [];
  updateResults();
}

function loadDashboard() {
  log('Loading sprite dashboard...', 'info');
  document.getElementById('dashboard-frame').src = '/sprite-dashboard.html';
}

async function runAllTests() {
  clearResults();
  log('ðŸš€ Starting automated tests...', 'info');
  
  // Load the dashboard
  loadDashboard();
  
  // Wait for load
  await new Promise(resolve => setTimeout(resolve, 2000));
  
  const iframe = document.getElementById('dashboard-frame');
  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
  
  if (!iframeDoc) {
    log('âŒ Failed to access iframe document', 'error');
    return;
  }
  
  // Test 1: Check if UI elements exist
  log('ðŸ“‹ Test 1: Checking UI elements...', 'info');
  const header = iframeDoc.querySelector('header');
  const search = iframeDoc.querySelector('#search');
  const grid = iframeDoc.querySelector('#grid');
  const basket = iframeDoc.querySelector('#basket-panel');
  
  if (header && search && grid && basket) {
    log('âœ… All main UI elements found', 'info');
  } else {
    log('âŒ Missing UI elements', 'error');
    return;
  }
  
  // Test 2: Check sprite count
  log('ðŸ“‹ Test 2: Checking sprite count...', 'info');
  await new Promise(resolve => setTimeout(resolve, 1000));
  
  const spriteCountEl = iframeDoc.querySelector('#sprite-count');
  if (spriteCountEl) {
    const countText = spriteCountEl.textContent;
    log(`âœ… Sprite count: ${countText}`, 'info');
  } else {
    log('âŒ Sprite count element not found', 'error');
  }
  
  // Test 3: Check for cards
  log('ðŸ“‹ Test 3: Checking sprite cards...', 'info');
  const cards = iframeDoc.querySelectorAll('.card');
  log(`âœ… Found ${cards.length} sprite cards`, 'info');
  
  // Test 4: Wait for sprites to load
  log('ðŸ“‹ Test 4: Waiting for sprites to load (5 seconds)...', 'info');
  await new Promise(resolve => setTimeout(resolve, 5000));
  
  const loadingCards = Array.from(iframeDoc.querySelectorAll('.card-loading'))
    .filter(el => el.style.display !== 'none');
  const errorCards = iframeDoc.querySelectorAll('.card-error');
  const workingCanvases = iframeDoc.querySelectorAll('canvas[data-loaded="true"]');
  
  log(`ðŸ“Š Loading: ${loadingCards.length}, Errors: ${errorCards.length}, Working: ${workingCanvases.length}`, 'info');
  
  if (errorCards.length > 0) {
    log(`âš ï¸ Found ${errorCards.length} failed sprites:`, 'error');
    errorCards.forEach(errorEl => {
      const card = errorEl.closest('.card');
      if (card) {
        const spriteId = card.dataset.spriteId;
        const name = card.querySelector('.card-name')?.textContent;
        log(`  - ${spriteId} (${name})`, 'error');
      }
    });
  } else {
    log('âœ… No failed sprites detected', 'info');
  }
  
  // Test 5: Test filters
  log('ðŸ“‹ Test 5: Testing category filters...', 'info');
  const filterButtons = iframeDoc.querySelectorAll('.filter-btn');
  log(`âœ… Found ${filterButtons.length} filter buttons`, 'info');
  
  // Click a filter
  const fxPack1Btn = Array.from(filterButtons).find(btn => btn.dataset.cat === 'FX Pack 1');
  if (fxPack1Btn) {
    fxPack1Btn.click();
    await new Promise(resolve => setTimeout(resolve, 500));
    const visibleCards = iframeDoc.querySelectorAll('.card');
    log(`âœ… Clicked 'FX Pack 1' filter - ${visibleCards.length} cards visible`, 'info');
    
    // Reset to All
    const allBtn = Array.from(filterButtons).find(btn => btn.dataset.cat === 'All');
    if (allBtn) allBtn.click();
  }
  
  // Test 6: Test basket
  log('ðŸ“‹ Test 6: Testing basket functionality...', 'info');
  const firstWorkingCanvas = iframeDoc.querySelector('canvas[data-loaded="true"]');
  if (firstWorkingCanvas) {
    const card = firstWorkingCanvas.closest('.card');
    const addBtn = card.querySelector('.add-btn');
    const spriteId = card.dataset.spriteId;
    const spriteName = card.querySelector('.card-name')?.textContent;
    
    log(`  Adding sprite: ${spriteName} (${spriteId})`, 'info');
    addBtn.click();
    
    await new Promise(resolve => setTimeout(resolve, 500));
    
    const basketCount = iframeDoc.querySelector('#basket-count')?.textContent;
    const basketItems = iframeDoc.querySelectorAll('.basket-item');
    
    log(`âœ… Basket count: ${basketCount}, Items: ${basketItems.length}`, 'info');
    
    if (basketItems.length > 0) {
      const itemName = basketItems[0].querySelector('.basket-item-name')?.textContent;
      log(`âœ… First basket item: ${itemName}`, 'info');
    }
  } else {
    log('âš ï¸ No working sprites found to test basket', 'error');
  }
  
  // Final summary
  log('ðŸŽ‰ All tests completed!', 'info');
  log(`ðŸ“Š Summary: ${cards.length} total cards, ${workingCanvases.length} working, ${errorCards.length} failed`, 'info');
}

// Auto-load on page load
window.addEventListener('load', () => {
  log('Tester ready. Click "Run All Tests" to begin.', 'info');
});
</script>
</body>
</html>
