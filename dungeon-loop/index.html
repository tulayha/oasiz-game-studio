<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Dungeon Loop</title>
    <link rel="stylesheet" href="/style.css">

    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'industrial-bg': '#121212', // Very dark charcoal gray
                        'industrial-module': '#d1d5db', // Light cool gray (zinc-300ish)
                        'industrial-black': '#000000', // Strong black
                        'industrial-accent': '#c54b4b', // Bright desaturated red
                        'industrial-placeholder': 'rgba(0, 0, 0, 0.15)',
                    },
                    fontFamily: {
                        display: ["'Press Start 2P'", "cursive"],
                        cinzel: ["'Cinzel'", "serif"],
                    },
                    borderRadius: {
                        DEFAULT: "8px",
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                },
            },
        };
    </script>
    <style type="text/tailwindcss">
        .pixel-border {
            border: 4px solid theme('colors.industrial-black');
            box-shadow: 
                inset -4px -4px 0px 0px rgba(0,0,0,0.1),
                4px 4px 0px 0px rgba(0,0,0,0.4);
        }
        .pixel-button {
            border: 4px solid theme('colors.industrial-black');
            box-shadow: inset -4px -4px 0px 0px rgba(0,0,0,0.5);
            transition: transform 0.1s, background-color 0.2s;
        }
        .pixel-button:active {
            transform: scale(0.95);
            box-shadow: inset 4px 4px 0px 0px rgba(0,0,0,0.5);
        }
        .placeholder-box {
            background-color: theme('colors.industrial-placeholder');
            border-radius: 2px;
        }
        
        /* Overlay Container */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .menu-container {
            pointer-events: auto;
        }

        /* Title Glow Effect */
        .title-glow {
            text-shadow: 0 0 10px #c54b4b, 0 0 20px #c54b4b, 0 0 40px #000000;
        }
        
        .menu-fade-out {
            animation: fadeOut 0.8s forwards;
            pointer-events: none;
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @media (pointer: coarse) {
            #btn-skip-tutorial {
                top: 120px;
            }
        }

        /* ── Start Screen Animations ── */

        @keyframes btnSlideUp {
            0%   { transform: translateY(30px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .menu-btn-animated {
            opacity: 0;
            animation: btnSlideUp 0.5s ease-out forwards;
        }
        .menu-btn-animated.btn-delay-1 { animation-delay: 400ms; }
        .menu-btn-animated.btn-delay-2 { animation-delay: 550ms; }
        .menu-btn-animated.btn-delay-3 { animation-delay: 700ms; }

        /* Menu title entrance */
        @keyframes titleReveal {
            0%   { opacity: 0; transform: translateY(-20px) scale(0.9); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        .menu-title-animated {
            animation: titleReveal 0.8s ease-out forwards, float 3s ease-in-out infinite 1s;
        }

        /* ── Fire Title Effect ── */
        .fire-title {
            position: relative;
            display: inline-block;
        }

        .fire-title h1 {
            position: relative;
            z-index: 2;
            color: #fff;
            text-shadow:
                0 0 10px #ff4500,
                0 0 20px #ff4500,
                0 0 40px #ff6a00,
                0 0 80px #ff4500,
                0 -5px 10px rgba(255,69,0,0.6),
                0 -10px 20px rgba(255,140,0,0.4),
                0 -15px 40px rgba(255,69,0,0.2);
        }

        /* Ember particles rising from title */
        .fire-embers {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: visible;
        }

        .ember {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #ff6a00;
            animation: emberRise linear infinite;
            opacity: 0;
        }

        @keyframes emberRise {
            0%   { transform: translateY(0) translateX(0) scale(1); opacity: 0; }
            10%  { opacity: 1; }
            50%  { opacity: 0.8; }
            100% { transform: translateY(-80px) translateX(var(--drift)) scale(0); opacity: 0; }
        }

        /* Flickering glow behind the title */
        @keyframes fireGlow {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            25%      { opacity: 0.7; transform: scale(1.02); }
            50%      { opacity: 0.5; transform: scale(0.98); }
            75%      { opacity: 0.8; transform: scale(1.01); }
        }

        .fire-backdrop {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120%;
            height: 200%;
            background: radial-gradient(ellipse at center, rgba(255,69,0,0.3) 0%, rgba(255,140,0,0.1) 40%, transparent 70%);
            animation: fireGlow 2s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        /* Heat shimmer on the text */
        @keyframes heatShimmer {
            0%, 100% { filter: blur(0px); }
            50%      { filter: blur(0.5px); }
        }

        .fire-title h1 {
            animation: heatShimmer 3s ease-in-out infinite;
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="game-container"></div>
    </div>

    <div id="ui-layer">
        <!-- Main Menu -->
        <div id="main-menu"
            class="absolute inset-0 bg-gradient-to-b from-black/90 via-black/50 to-black/90 flex flex-col items-center justify-center space-y-10 z-50 pointer-events-auto transition-opacity duration-1000 overflow-hidden">

            <!-- Title with Fire Effect -->
            <div class="text-center z-10 menu-title-animated fire-title" style="opacity:0;">
                <div class="fire-backdrop"></div>
                <div class="fire-embers" id="fire-embers"></div>
                <h1
                    class="font-display text-5xl md:text-7xl text-white tracking-widest stroke-black stroke-2">
                    DUNGEON LOOP
                </h1>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col items-center space-y-5 z-10">
                <button id="btn-continue"
                    class="hidden pixel-button bg-industrial-black text-white px-12 py-6 text-xl font-display hover:bg-gray-800 hover:scale-105 transition-all menu-btn-animated btn-delay-1">
                    CONTINUE
                </button>
                <button id="btn-play"
                    class="pixel-button bg-industrial-accent text-white px-12 py-6 text-xl font-display hover:bg-red-600 hover:scale-105 transition-all menu-btn-animated btn-delay-2">
                    PLAY GAME
                </button>
                <button id="btn-tutorial"
                    class="hidden text-white/50 text-sm font-display hover:text-white/80 transition-all underline menu-btn-animated btn-delay-3">
                    REPLAY TUTORIAL
                </button>
            </div>
        </div>

        <!-- Skip Tutorial Button (shown during tutorial gameplay) -->
        <button id="btn-skip-tutorial"
            class="hidden absolute top-[45px] right-[20px] pixel-button bg-black/70 text-white/80 px-5 py-2 text-sm font-display hover:bg-black/90 hover:text-white transition-all z-[60] pointer-events-auto">
            SKIP
        </button>

        <!-- Pause Menu -->
        <div id="pause-menu" class="hidden menu-container max-w-sm w-full p-4">
            <div class="pixel-border bg-industrial-module p-8 rounded-xl flex flex-col items-center gap-6 shadow-2xl">
                <h2 class="font-display text-2xl text-industrial-black mb-2 tracking-widest">PAUSED</h2>

                <div class="w-full h-2 bg-industrial-black mb-4 opacity-20"></div>

                <button id="btn-resume"
                    class="pixel-button bg-industrial-black text-white w-full py-4 text-sm font-display hover:bg-gray-800 transition-colors">
                    RESUME
                </button>

                <div class="w-full space-y-3">
                    <div class="flex justify-between items-center pixel-button bg-gray-200 p-3 cursor-pointer hover:bg-white transition-colors"
                        id="btn-toggle-music">
                        <span class="font-display text-xs text-industrial-black">MUSIC</span>
                        <span class="font-display text-xs text-industrial-accent" id="val-music">ON</span>
                    </div>
                    <div class="flex justify-between items-center pixel-button bg-gray-200 p-3 cursor-pointer hover:bg-white transition-colors"
                        id="btn-toggle-fx">
                        <span class="font-display text-xs text-industrial-black">FX</span>
                        <span class="font-display text-xs text-industrial-accent" id="val-fx">ON</span>
                    </div>
                    <div class="flex justify-between items-center pixel-button bg-gray-200 p-3 cursor-pointer hover:bg-white transition-colors"
                        id="btn-toggle-haptics">
                        <span class="font-display text-xs text-industrial-black">HAPTICS</span>
                        <span class="font-display text-xs text-industrial-accent" id="val-haptics">ON</span>
                    </div>
                </div>

                <button id="btn-restart"
                    class="pixel-button bg-industrial-accent text-white w-full py-4 text-sm font-display hover:bg-red-700 transition-colors">
                    RESTART
                </button>
            </div>
        </div>

        <!-- Skills Info Menu -->
        <div id="skills-info-menu" class="hidden menu-container w-full max-w-3xl p-1" style="max-height:97%;box-sizing:border-box;">
            <div class="pixel-border bg-industrial-module p-2 rounded-xl flex flex-col items-center gap-1" style="max-height:calc(100vh - 20px);box-sizing:border-box;overflow:hidden;">
                <!-- Header: fixed at top -->
                <div class="flex items-center justify-between w-full" style="flex-shrink:0;">
                    <h2 id="skills-info-title" class="font-display text-2xl text-industrial-black tracking-widest">SKILLS</h2>
                    <span id="skills-gold-display" class="font-display text-sm" style="color:#c8a22a;">GOLD: 0</span>
                </div>

                <!-- Tab bar -->
                <div class="skill-tab-bar w-full" style="flex-shrink:0;">
                    <button id="skill-tab-btn-stats" class="skill-tab-btn active">Stats</button>
                    <button id="skill-tab-btn-skills" class="skill-tab-btn">Skills</button>
                </div>

                <!-- Tab content: Stats -->
                <div id="skills-tab-stats" class="skill-info-list w-full" style="flex:1 1 auto;overflow-y:auto;min-height:0;"></div>

                <!-- Tab content: Skills (hidden by default) -->
                <div id="skills-tab-skills" class="skill-info-list w-full hidden" style="flex:1 1 auto;overflow-y:auto;min-height:0;"></div>

                <!-- Hint text for tutorial (hidden by default) -->
                <div id="skills-close-hint" style="display:none;color:#ff6644;font-family:'Press Start 2P',monospace;font-size:0.6rem;text-align:center;margin-bottom:4px;"></div>
                <!-- Close button: fixed at bottom -->
                <button id="btn-skillinfo-close"
                    class="pixel-button bg-industrial-accent text-white w-full max-w-xs py-3 text-sm font-display hover:bg-red-700 transition-colors"
                    style="flex-shrink:0;">
                    CLOSE
                </button>
            </div>
        </div>

        <!-- Character Select Menu -->
        <div id="character-select-menu" class="hidden menu-container w-full max-w-5xl p-4">
            <div class="pixel-border bg-industrial-module p-8 rounded-xl flex flex-col items-center gap-5 shadow-2xl">
                <h2 class="font-display text-2xl text-industrial-black mb-2 tracking-widest">SELECT CHARACTER</h2>

                <div class="w-full h-2 bg-industrial-black mb-4 opacity-20"></div>

                <div class="character-options-grid w-full">
                    <button id="btn-char-option-1"
                        class="pixel-button char-option-card bg-industrial-black text-white font-display hover:bg-gray-800 transition-colors">
                        <span class="char-sprite char-sprite-knight" aria-hidden="true"></span>
                        <span class="char-name">WARRIOR</span>
                    </button>
                    <button id="btn-char-option-2"
                        class="pixel-button char-option-card bg-industrial-black text-white font-display hover:bg-gray-800 transition-colors">
                        <span class="char-sprite char-sprite-mage" aria-hidden="true"></span>
                        <span class="char-name">MAGE</span>
                    </button>
                    <button id="btn-char-option-3"
                        class="pixel-button char-option-card bg-industrial-black text-white font-display hover:bg-gray-800 transition-colors">
                        <span class="char-sprite char-sprite-rogue" aria-hidden="true"></span>
                        <span class="char-name">ROGUE</span>
                    </button>
                </div>

                <button id="btn-char-cancel"
                    class="pixel-button bg-industrial-accent text-white w-full max-w-xs py-4 text-sm font-display hover:bg-red-700 transition-colors">
                    CANCEL
                </button>
            </div>
        </div>

        <!-- Game Over Menu -->
        <div id="gameover-menu" class="hidden menu-container max-w-sm w-full p-4">
            <div class="pixel-border bg-industrial-module p-8 rounded-xl flex flex-col items-center gap-6 shadow-2xl">
                <h2 class="font-display text-2xl text-industrial-accent mb-2 tracking-widest">GAME OVER</h2>

                <div class="w-full h-2 bg-industrial-black mb-4 opacity-20"></div>

                <div class="flex flex-col items-center w-full bg-industrial-placeholder p-6 rounded pixel-border mb-2">
                    <span class="font-display text-xs text-industrial-black mb-3">FINAL SCORE</span>
                    <span id="score-display" class="font-display text-4xl text-industrial-black">0</span>
                </div>

                <button id="btn-retry"
                    class="pixel-button bg-industrial-black text-white w-full py-4 text-sm font-display hover:bg-gray-800 transition-colors">
                    TRY AGAIN
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
</body>

</html>
